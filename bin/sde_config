#! /usr/bin/env bash

panic()
{
	echo "ERROR"
	exit 1
}

sde_root_dir="${SDE_TOP_DIR}"
package=
version=

while getopts d:p:v: opt; do
	case "$opt" in
	d)
		sde_root_dir="$OPTARG";;
	p)
		package="$OPTARG";;
	v)
		version="$OPTARG";;
	\?)
		usage
		break;;
	esac
done
shift $((OPTIND - 1))

if [ -z "$sde_root_dir" ]; then
	usage "no SDE root directory specified"
fi
if [ -z "$package" ]; then
	usage "no package specified"
fi
if [ -z "$version" ]; then
	usage "no version specified"
fi

# Set the user file-creation mask to allow read and execute permissions
# for the group and others.
umask 022

packages_dir="$sde_root_dir/packages"
package_symlink="$packages_dir/$package"

if [ -L "$package_symlink" ]; then
	rm -f "$package_symlink" || panic "cannot remove $package_symlink"
fi

ln -s "$package-$version" "$package_symlink" || \
  panic "cannot make symbolic link $package_symlink"

